import{u as z}from"./D7U4-Zak.js";import{g as P,j as q,r as L,k as v,c as h,o as $,n as m,a as d,t as A,l as g,_ as k,m as O,p as S,q as F,s as te,b,v as se,F as R,x as W,y as oe,z as ne,A as I}from"./Dyv1RUr0.js";const re=P({__name:"info",setup(c){const e=z(),s=q(),f=L("Нажмите стрелки для движения"),i=v(()=>e.currentLevel?Math.max(0,e.currentLevel.mimic.delay-e.moves):0),l=v(()=>e.currentLevel?e.moves<e.currentLevel.mimic.delay?"Мимик не появился":e.hasMimicFinished?"Мимик остановился":"Мимик в движении":"Нет уровня"),_=v(()=>{if(!e.currentLevel)return"";const o=e.currentLevel.mimic.moveLimit,a=e.moveHistory.slice(1);return a.slice(0,o).map((r,p)=>{var u;const y=p>0?a[p-1]:(u=e.currentLevel)==null?void 0:u.player;return y?r.row<y.row?"↑":r.row>y.row?"↓":r.col>y.col?"→":r.col<y.col?"←":"":""}).join(" ")}),t=()=>{if(!e.currentLevel){console.warn("No level loaded, redirecting to home"),s.push("/");return}try{e.loadLevel(e.currentLevel)}catch(o){console.error("Error resetting game:",o),s.push("/")}},n=()=>{e.$reset(),s.push("/")};return(o,a)=>($(),h("div",{class:m(o.$style.gameInfo)},[d("div",{class:m(o.$style.controls)},[d("button",{onClick:n,class:"button"},"←"),d("button",{onClick:t,class:"button"},"↻")],2),d("div",{class:m(o.$style.stats)},[d("div",{class:m(o.$style.statItem)},[a[0]||(a[0]=d("span",null,"Статус",-1)),d("span",{class:m(o.$style.value)},A(g(f)),3)],2),d("div",{class:m(o.$style.statItem)},[a[1]||(a[1]=d("span",null,"Ходов до появления мимика",-1)),d("span",{class:m(o.$style.value)},A(g(i)),3)],2),d("div",{class:m(o.$style.statItem)},[a[2]||(a[2]=d("span",null,"Мимик:",-1)),d("span",{class:m(o.$style.value)},A(g(l)),3)],2),d("div",{class:m(o.$style.statItem)},[a[3]||(a[3]=d("span",null,"Повторяемые ходы:",-1)),d("span",{class:m(o.$style.value)},A(g(_)),3)],2)],2)],2))}}),le="_gameInfo_tpz2a_7",ie="_controls_tpz2a_19",ae="_stats_tpz2a_25",ce="_statItem_tpz2a_30",ue="_value_tpz2a_44",me="_pattern_tpz2a_49",pe={gameInfo:le,controls:ie,stats:ae,statItem:ce,value:ue,pattern:me},ve={$style:pe},de=k(re,[["__cssModules",ve]]),fe=P({__name:"entity",props:{type:{},pos:{},lastPos:{},facing:{}},setup(c,{expose:e}){const s=c,f=z(),i=L(null),l=L(null),_=L(!1),t=L(!1),n=v(()=>_.value?"run":"idle");O(()=>f.gameOver,r=>{r&&s.type==="player"&&(i.value&&console.log("gameOver",i.value.style.transform),t.value=!0)});const o=(r,p,y=200)=>{if(console.log("animate",r,p,y,s.type),!i.value){console.error("Entity ref is not defined");return}if(t.value){const B=performance.now(),D=300,G=r.col*80,E=r.row*80,T=p.col*80,J=p.row*80,V=Q=>{const Z=Q-B,M=Math.min(Z/D,1),x=G+(T-G)*M,ee=E+(J-E)*M;let C,X;M<=.2?(C=0,X=1):(C=-(M-.2)*337.5,X=1-M),i.value.style.transform=`
        translate(${x}px, ${ee}px)
        scaleX(${s.facing==="left"?-1:1})
        rotate(${C}deg)
      `,i.value.style.opacity=`${X}`,M<1?l.value=requestAnimationFrame(V):(l.value&&cancelAnimationFrame(l.value),l.value=null,t.value=!1)};l.value=requestAnimationFrame(V);return}if(r.row===p.row&&r.col===p.col){console.log("startPos and endPos are the same, skipping animation");return}l.value&&(cancelAnimationFrame(l.value),l.value=null),_.value=!0;const u=r.col*80,w=r.row*80,Y=p.col*80,H=p.row*80,K=performance.now(),N=B=>{const D=B-K,G=Math.min(D/y,1),E=u+(Y-u)*G,T=w+(H-w)*G;i.value.style.transform=`translate(${E}px, ${T}px) scaleX(${s.facing==="left"?-1:1})`,G<1?l.value=requestAnimationFrame(N):(l.value=null,_.value=!1)};l.value=requestAnimationFrame(N)},a=r=>{if(!i.value)return;const p=r.col*80,y=r.row*80;i.value.style.transform=`translate(${p}px, ${y}px) scaleX(${s.facing==="left"?-1:1})`,i.value.style.opacity="1",l.value&&(cancelAnimationFrame(l.value),l.value=null),_.value=!1};return S(()=>{a(s.pos)}),O(()=>s.pos,(r,p)=>{a(r),o(p,r)}),e({setPosition:a,animate:o}),(r,p)=>($(),h("div",{ref_key:"entityRef",ref:i,class:m([r.$style.GameEntity,r.$style[r.type],r.$style[s.facing==="left"?"facing-left":"facing-right"],r.$style[n.value],r.$style[t.value?"dying":""]])},null,2))}}),ye="_GameEntity_1mfhy_7",_e="_player_1mfhy_16",ge="_idle_1mfhy_19",$e="_run_1mfhy_24",he="_mimic_1mfhy_30",we="_death_1mfhy_1",Le={GameEntity:ye,player:_e,idle:ge,run:$e,mimic:he,"facing-left":"_facing-left_1mfhy_44","facing-right":"_facing-right_1mfhy_48",death:we},Ge={$style:Le},U=k(fe,[["__cssModules",Ge]]),Me=P({__name:"tile",props:{position:{}},setup(c){const e=c,s=z(),f=v(()=>s.isPlatform(e.position.row,e.position.col)),i=v(()=>s.isLadder(e.position.row,e.position.col)),l=v(()=>{if(!i.value)return!1;const{row:u,col:w}=e.position;return!s.isLadder(u+1,w)}),_=v(()=>!i.value||l.value?!1:s.isPlatform(e.position.row,e.position.col-1)),t=v(()=>!i.value||l.value?!1:s.isPlatform(e.position.row,e.position.col+1)),n=v(()=>!i.value||l.value?!1:_.value||t.value),o=v(()=>s.isDoor(e.position.row,e.position.col)),a=v(()=>s.isDoorOpen(e.position.row,e.position.col)),r=v(()=>s.isButton(e.position.row,e.position.col)),p=v(()=>s.isButtonActive(e.position.row,e.position.col)),y=v(()=>{var u,w;return e.position.row===((u=s.currentLevel)==null?void 0:u.exit.row)&&e.position.col===((w=s.currentLevel)==null?void 0:w.exit.col)});return(u,w)=>($(),h("div",{class:m([u.$style.cell,{[u.$style["is-platform"]]:f.value,[u.$style["is-ladder"]]:i.value,[u.$style["is-ladder-ground"]]:l.value,[u.$style["is-ladder-mid"]]:n.value,[u.$style["is-door"]]:o.value,[u.$style["is-button"]]:r.value,[u.$style["is-exit"]]:y.value}])},[o.value?($(),h("div",{key:0,class:m([u.$style.door,{[u.$style["is-open"]]:a.value}])},null,2)):F("",!0),r.value?($(),h("div",{key:1,class:m([u.$style.button,{[u.$style["is-active"]]:p.value}])},null,2)):F("",!0),y.value?($(),h("div",{key:2,class:m(u.$style.exit)},null,2)):F("",!0)],2))}}),ze="_cell_1wwiv_7",Pe="_door_1wwiv_26",ke="_button_1wwiv_41",be="_exit_1wwiv_56",Ee={cell:ze,"is-platform":"_is-platform_1wwiv_14","is-ladder":"_is-ladder_1wwiv_17","is-ladder-ground":"_is-ladder-ground_1wwiv_20","is-ladder-mid":"_is-ladder-mid_1wwiv_23",door:Pe,"is-open":"_is-open_1wwiv_38",button:ke,"is-active":"_is-active_1wwiv_53",exit:be},Ae={$style:Ee},Fe=k(Me,[["__cssModules",Ae]]),Ie=P({__name:"grid",setup(c){const e=z(),s=L(null),f=L(null),i=v(()=>{var t;return((t=e.currentLevel)==null?void 0:t.gridSize)||0});v(()=>{var t;return{playerPos:e.playerPos,mimicPos:e.mimicPos,currentLevel:e.currentLevel,gridSize:(t=e.currentLevel)==null?void 0:t.gridSize}});const l=()=>{s.value&&s.value.setPosition(e.playerPos),f.value&&e.mimicPos&&!e.gameOver&&f.value.setPosition(e.mimicPos)},_=v(()=>({playerPos:e.playerPos,mimicPos:e.mimicPos,gameOver:e.gameOver,doors:e.doors,moves:e.moves,mimicMoves:e.mimicMoves,currentLevel:e.currentLevel}));return O(_,(t,n)=>{(t.playerPos!==n.playerPos||t.mimicPos!==n.mimicPos||t.gameOver&&!n.gameOver||t.doors!==n.doors||t.moves!==n.moves||t.mimicMoves!==n.mimicMoves||t.currentLevel!==n.currentLevel)&&l()},{deep:!0}),S(()=>{l()}),te(()=>{s.value=null,f.value=null}),(t,n)=>($(),h("div",{class:m(t.$style.GameGrid)},[d("div",{class:m(t.$style.entitiesLayer)},[b(U,{ref_key:"playerEntity",ref:s,type:"player",pos:g(e).playerPos,"last-pos":g(e).playerLastPos,facing:g(e).playerFacing},null,8,["pos","last-pos","facing"]),g(e).mimicPos?($(),se(U,{key:0,ref_key:"mimicEntity",ref:f,type:"mimic",pos:g(e).mimicPos,"last-pos":g(e).mimicLastPos,facing:g(e).mimicFacing},null,8,["pos","last-pos","facing"])):F("",!0)],2),d("div",{class:m(t.$style.grid)},[($(!0),h(R,null,W(g(i),o=>($(),h("div",{key:o,class:m(t.$style.row)},[($(!0),h(R,null,W(g(i),a=>($(),h("div",{key:a,class:m(t.$style.cell)},[b(Fe,{position:{row:o-1,col:a-1}},null,8,["position"])],2))),128))],2))),128))],2)],2))}}),Oe="_GameGrid_5vz0z_7",Se="_entitiesLayer_5vz0z_15",Be="_grid_5vz0z_24",De="_row_5vz0z_34",Te="_cell_5vz0z_41",Ce="_debug_5vz0z_49",Xe={GameGrid:Oe,entitiesLayer:Se,grid:Be,row:De,cell:Te,debug:Ce},je={$style:Xe},qe=k(Ie,[["__cssModules",je]]);function Ye(c){return oe()?(ne(c),!0):!1}const Ne=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Ve=Object.prototype.toString,Re=c=>Ve.call(c)==="[object Object]";function j(c){return Array.isArray(c)?c:[c]}function We(c,e,s){return O(c,e,{...s,immediate:!0})}const Ue=Ne?window:void 0;function He(c){var e;const s=I(c);return(e=s==null?void 0:s.$el)!=null?e:s}function Ke(...c){const e=[],s=()=>{e.forEach(t=>t()),e.length=0},f=(t,n,o,a)=>(t.addEventListener(n,o,a),()=>t.removeEventListener(n,o,a)),i=v(()=>{const t=j(I(c[0])).filter(n=>n!=null);return t.every(n=>typeof n!="string")?t:void 0}),l=We(()=>{var t,n;return[(n=(t=i.value)==null?void 0:t.map(o=>He(o)))!=null?n:[Ue].filter(o=>o!=null),j(I(i.value?c[1]:c[0])),j(g(i.value?c[2]:c[1])),I(i.value?c[3]:c[2])]},([t,n,o,a])=>{if(s(),!(t!=null&&t.length)||!(n!=null&&n.length)||!(o!=null&&o.length))return;const r=Re(a)?{...a}:a;e.push(...t.flatMap(p=>n.flatMap(y=>o.map(u=>f(p,y,u,r)))))},{flush:"post"}),_=()=>{l(),s()};return Ye(s),_}const Je=P({__name:"TheGame",setup(c){const e=z(),s=q(),f=()=>e.currentLevel?!0:(console.warn("No level loaded, redirecting to home"),s.push("/"),!1),i=t=>{try{const n=e.movePlayer(t);if(n){const o=document.querySelector("#status span");o&&(o.textContent=n)}}catch(n){console.error("Error moving player:",n)}},l=t=>{if(!f())return;const n=t.key.replace("Arrow","").toLowerCase();_(n)&&i(n)},_=t=>["left","right","up","down"].includes(t);return Ke(document,"keydown",l),S(()=>{f()}),(t,n)=>{const o=de,a=qe;return $(),h("div",{class:m(t.$style.TheGame)},[b(o),b(a)],2)}}}),Qe="_TheGame_1wjp7_7",Ze={TheGame:Qe},xe={$style:Ze},et=k(Je,[["__cssModules",xe]]),tt=P({__name:"game",setup(c){const e=z(),s=q();return S(()=>{e.currentLevel||s.push("/")}),(f,i)=>{const l=et;return $(),h("div",{class:m([f.$style.GamePage,"page container"])},[b(l)],2)}}}),st={},ot={$style:st},lt=k(tt,[["__cssModules",ot]]);export{lt as default};
